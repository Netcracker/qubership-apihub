# Qubership APIHUB Installation Guide

## 3rd party dependencies

| Name | Version | Mandatory/Optional | Comment |
| ---- | ------- |------------------- | ------- |
| PostgreSQL | 14+ | Mandatory | JDBC connection string |
| GitLab | 14+ | Optional | For APIHUB Editor |
| Minio | 1.2.3 | Optional | For store cold data and reduce load to PG |
| ADFS | Any | Optional | For SSO |
| LDAP | Any | Optional | For User infro |

## HWE

|     | CPU request | CPU limit | RAM request | RAM limit |
| --- | ----------- | --------- | ----------- | --------- |
| Dev level        | 200m | 4   | 2908 | 2908 |
| Production level | 2    | 11  | 8780 | 8780 |

## docker-compose

Please refer to [`docker-compose/README.md`](/docker-compose/README.md)

## Helm

todo

## Minimal deploy parameters set

```INI
APIHUB_POSTGRESQL_DB_NAME=apihub;
APIHUB_POSTGRESQL_USERNAME=apihub;
APIHUB_POSTGRESQL_PASSWORD=apihub;
APIHUB_POSTGRESQL_PORT=5432;
JWT_PRIVATE_KEY={use generated key here};
```

### Full deploy parameters list

| Deploy Parameter name | Default Value | Description |
| --- | --- | --- |
| **apihub-backend** |     |     |
| APIHUB_URL |     | APIHUB server URL. Autogenerated if empty |
| ADFS_METADATA_URL |     | ADFS metadata URL. Required for SSO integration |
| CLIENT_ID |     | For Gitlab integration. Provided by IT |
| CLIENT_SECRET |     | For Gitlab integration. Provided by IT |
| DB_TYPE | postgres |     |
| DIFF_SERVICE_URL | <http://apihub-node-service:3000> |     |
| GITLAB_URL | <https://git.qubership.com> |     |
| JWT_PRIVATE_KEY |     | Self generated private PKCS#8 private key in base64 encode format. |
| LDAP_SERVER | ldap://10.10.1.1:389 | LDAP server URL. Required for LDAP integration for getting user info by login |
| LDAP_USER | x_APIHUB | LDAP User used for connecting to LDAP server |
| LDAP_USER_PASSWORD |     | Password for LDAP User |
| STORAGE_SERVER_USERNAME |     | Access Key ID from Minio S3 storage |
| STORAGE_SERVER_BUCKET_NAME | api-hub-prod | Bucket name in Minio S3 storage |
| STORAGE_SERVER_CRT |     | Certificate for accessing Minio S3 storage |
| STORAGE_SERVER_URL | apihub-minio.s3.qubership.com | Minio endpoint for client connection |
| STORAGE_SERVER_PASSWORD |     | Secret key for Minio S3 storage |
| ORIGIN_ALLOWED |     |     |
| APIHUB_POSTGRESQL_HOST | pg-common | PG host |
| APIHUB_POSTGRESQL_PORT | 5432 | PG port |
| APIHUB_POSTGRESQL_ADMIN_USERNAME |  | Admin user for APIHUB_POSTGRESQL_HOST cluster. Required for apihub database creation  |
| APIHUB_POSTGRESQL_ADMIN_PASSWORD |  | Password for APIHUB_POSTGRESQL_ADMIN_USERNAME for APIHUB_POSTGRESQL_HOST cluster. Required for apihub database creation |
| APIHUB_POSTGRESQL_DB_NAME | apihub_backend_{NAMESPACE}_db | Logical database in PG cluster for APIHUB. If APIHUB_SKIP_DB_CREATION=false - the database will be created automatically. Otherwise manual pre-creation required |
| APIHUB_POSTGRESQL_USERNAME | apihub_backend_{NAMESPACE}_admin | User for APIHUB_POSTGRESQL_DB_NAME database. If APIHUB_SKIP_DB_CREATION=false - the user will be created automatically. Otherwise manual pre-creation required |
| APIHUB_POSTGRESQL_PASSWORD | apihub_backend_{NAMESPACE}_password | Password for APIHUB_POSTGRESQL_USERNAME user. |
| PUBLISH_ARCHIVE_SIZE_LIMIT_MB | 25  | Limit for uploaded package size in order to avoid OOM |
| PUBLISH_FILE_SIZE_LIMIT_MB | 15  | Limit for uploaded file (inside package) size in order to avoid OOM |
| RELEASE_VERSION_PATTERN | ^\[0-9\]{4}\[.\]{1}\[1-4\]{1}$ | Regex pattern for releases names validation. |
| SAML_CRT |     | Self singed certificate in base64 encode format. |
| SAML_KEY |     | Self created private key in base64 encoded format |
| SYSTEM_NOTIFICATION |     | If set - footer with this text is shown for alll APIHUB users in APIHUB UI. Designed for maintenance windows. |
| INSECURE_PROXY | false | Set to true to enable apihub playground work without authtorization. |
| MONITORING_ENABLED | true | Set to true to enable Prometheus metrics |
| MINIO_STORE_ONLY_BUILD_RESULT | true | Set to true to store only build results in S3 storage |
| MINIO_STORAGE_ACTIVE | true | Set to true to enable S3 integration. Used for store cold data |
| PRODUCTION_MODE | false | Enables production mode - login under local apihub users is prohibited in this mode |
| APIHUB_ADMIN_EMAIL |  | Default admin user login (example: apihub). If set - this user will be created automatically. |
| APIHUB_ADMIN_PASSWORD |  | Default admin user password (example: password) |
| APIHUB_ACCESS_TOKEN |  | Default access system access token (any string). If set - will be created automatically |

| Deploy Parameter name | Default Value | Description |
| --- | --- | --- |
| **apihub-ui** |     |     |
| APIHUB_URL |     | APIHUB server URL. |
| APIHUB_ACCESS_TOKEN |     | APIHUB server admin access token. |
| DNS_ROUTE_ENABLE |     | Set to true to enable Ingress bounded to external DNS name. |
| DNS_ROUTE |     | DNS name for Ingress. Required if DNS_ROUTE_ENABLE=true. |
| APIHUB_BACKEND_ADDRESS | apihub-backend:8080 | apihub-backend address. |
| APIHUB_NC_SERVICE_ADDRESS | apihub-nc-service:8080 | Custom add-on service address. |
| TLS_CRT |     | TLS certificate to be set on DNS Ingress. Required if DNS_ROUTE_ENABLE=true |
| TLS_KEY |     | TLS certificate puplic key to be set on DNS Ingress. Required if DNS_ROUTE_ENABLE=true" |


| Deploy Parameter name | Default Value | Description |
| --- | --- | --- |
| **apihub-node-service** |     |     |
| APIHUB_ACCESS_TOKEN |     | APIHUB server admin access token. |
| APIHUB_BACKEND_ADDRESS | apihub-backend:8080 | apihub-backend address. |
| FOLDER_STORE | /tmp | Folder to store file cache. Not required to be persistence volume |