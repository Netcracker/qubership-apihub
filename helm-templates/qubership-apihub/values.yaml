# Section with APIHUB Backend configuration
qubershipApihubBackend:
  image:
    repository: 'ghcr.io/netcracker/qubership-apihub-backend'
    tag: 'latest'
  replicas: 1

  # Section with resource limits
  # Mandatory
  # Below are the default values which are good enough for quick start, sandbox and over non production cases
  # For production usage increase CPU to 3 and memory to 3Gi
  resource:
    cpu:
      request: "100m"
      limit: "1"
    memory:
     limit: "512Mi"

  # Section with business and technical parameters for APIHUB.
  env:
    # Optional; Set log level on init to specified value. Values: Info, Warn, Error, etc; If not set, default value: INFO; Example: DEBUG
    logLevel: ''

    # Section with PostgreSQL database connection parameters
    database:
      # Mandatory; PostgreSQL database host ; If not set, default value: localhost; Example: postgres.example.com
      host: ''
      # Mandatory; PostgreSQL database port; If not set, default value: 5432; Example: 5432
      port:
      # Mandatory; Logical database in PostgreSQL cluster for APIHUB. Manual pre-creation required; If not set, default value: apihub; Example: apihub_backend_prod_db
      name: ''
      # Mandatory; User for database.name database; If not set, default value: apihub; Example: apihub_backend_prod_admin
      username: ''
      # Mandatory; Password for database.user.; If not set, default value: apihub; Example: apihub_backend_prod_password
      password: ''

    # Section with all security (authentication and authorization) parameters
    security:
      # Optional; Enables production mode - login under local apihub users is prohibited in this mode. In this mode only external IdP auth is possible; If not set, default value: true; Example: true
      productionMode: true  # set to false at your own risk
      # Section with parameters for configuring JWT tokens issued by APIHUB
      jwt:
        # Mandatory; Self generated private PKCS#8 private key, base64 encoded. Used for siging of JWT tokens issued by APIHUB, must be unique fore each APIHUB instance; If not set, default value: ""; Example: LS0tLS1CRUdJTiBQUklWQV...
        privateKey: ''
        # Optional; Duration in seconds for access tokens issued by APIHUB; If not set, default value: 1800; Example: 1800
        accessTokenDurationSec:
        # Optional; Duration in seconds for refresh tokens issued by APIHUB; If not set, default value: 43200; Example: 43200
        refreshTokenDurationSec:
      # Mandatory; Factual APIHUB server URL in your environment.; If not set, default value: ""; Example: https://apihub.example.com
      apihubExternalUrl: ''
      # Optional; Set to true to enable apihub playground work without authtorization. Dangerous. Not recommended; If not set, default value: false; Example: true
      insecureProxy: false
      # Optional; Allowed list of hosts that are accepted for proxy(playground) requests.; If not set, default value: []; Example: [example.com]
      allowedHostsForProxy: []
      # Optional; Allows to set extra allowed origins to CORS header. Used for FE debugging. Should be empty on prod envs.; If not set, default value: []; Example: [https://localhost:5137]
      allowedOrigins: []
      # Optional; Enables automatic login with the configured identity provider instead of showing the APIHUB login page; If not set, default value: false; Example: true
      autoLogin: false
      # Optional; To be deleted, WA for smooth upgrade of exisiting deployments; If not set, default value: true; Example: false
      legacySaml: true
      # Optional; List of external identity providers to use for authentication; OIDC and SAML types are supported. If not set, default value: []; Example:
      #   # Mandatory; ID for external identity provider; If not set, default value: ""; Example: external-saml-idp
      # - id: 'external-saml-idp'
      #   # Optional; Display name for external SAML identity provider; If not set, default value: ""; Example: External Identity Provider
      #   displayName: 'test'
      #   # Optional; SVG image for external SAML identity provider logo; If not set, default value: ""; Example: <svg fill="#000000" width="800px"...
      #   imageSvg: ''
      #   # Mandatory; Protocol for external identity provider; If not set, default value: ""; Example: SAML
      #   protocol: 'SAML'
      #   # Optional; SAML configuration for external identity provider, required if protocol is 'SAML'; If not set, default value: ""; Example:
      #   samlConfiguration:
      #     # Optional; SAML metadata URL. Required for SAML configuration; If not set, default value: ""; Example: https://idp.example.com/FederationMetadata/2007-06/FederationMetadata.xml
      #     metadataUrl: ''
      #     # Optional; SAML server certificate, base64 encoded. Required for SAML configuration; If not set, default value: ""; Example: LS0tLS1CRUdJTi...
      #     certificate: ''
      #     # Optional; SAML server private key, base64 encoded. Required for SAML configuration; If not set, default value: ""; Example: LS0tLS1CRUdJTi...
      #     privateKey: ''
      # # Mandatory; ID for external identity provider; If not set, default value: ""; Example: external-oidc-idp
      # - id: 'external-oidc-idp'
      #   # Optional; Display name for external OIDC identity provider; If not set, default value: ""; Example: External Identity Provider
      #   displayName: 'test'
      #   # Optional; SVG image for external OIDC identity provider logo; If not set, default value: ""; Example: <svg fill="#000000" width="800px"...
      #   imageSvg: ''
      #   # Mandatory; Protocol for external identity provider; If not set, default value: ""; Example: OIDC
      #   protocol: 'OIDC'
      #   # Optional; OIDC configuration for external identity provider, required if protocol is 'OIDC'; If not set, default value: ""; Example:
      #   oidcConfiguration:
      #     # Optional; OIDC identity provider URL. Required for OIDC configuration; If not set, default value: ""; Example: https://idp.example.com/realms/apihub
      #     providerUrl: ''
      #     # Optional; OIDC client ID. Required for OIDC configuration; If not set, default value: ""; Example: apihub
      #     clientId: ''
      #     # Optional; OIDC client secret. Required for OIDC configuration; If not set, default value: ""; Example: l5cKFvwDRSnhBErE9LUGeBk0dqqFB7No
      #     clientSecret: ''
      externalIdentityProviders: []

      # Section with LDAP integration parameters. LDAP integration is used for User search. Makes sense only if SAML/OIDC integration enabled.
      ldap:
        # Optional; LDAP server URL. Required for SAML integration for syncing users information; If not set, default value: ""; Example: ldap://ldap.example.com:389
        server: ''
        # Optional; LDAP User used for connecting to LDAP server; If not set, default value: ""; Example: x_apihub
        user: ''
        # Optional; Password for LDAP User; If not set, default value: ""; Example: x_apihub_password
        password: ''
        # Optional; Base DN to search users in; If not set, default value: ""; Example: organization
        baseDN: ''
        # Optional; Organization unit to search users in; If not set, default value: ""; Example: example
        organizationUnit: ''
        # Optional; Search base to search users in; If not set, default value: ""; Example: com
        searchBase: ''

    # Section with zero-day settings
    zeroDayConfiguration:
      # Mandatory; Default system access token (any string). The token will be provisioned automatically during startup; If not set, default value: ""; Example: access-token-12345
      accessToken: ''
      # Optional; Default local admin user login. If set - this admin user will be created automatically.; If not set, default value: ""; Example: admin@example.com
      adminEmail: ''
      # Optional; Default local admin user password; If not set, default value: ""; Example: admin-password
      adminPassword: ''

    # Section with various parameters related to APIHUB business logic
    businessParameters:
      # Optional; Links to be shown under (i) button in UI; If not set, default value: []; Example: [https://example.com]
      externalLinks: []
      # Optional; Default workspace ID for Agent UI; If not set, default value: ""; Example: QS
      defaultWorkspaceId: ''
      # Optional; Regex pattern for releases names validation.; If not set, default value: .*; Example: ^2023\.1$
      releaseVersionPattern: '.*'
      # Optional; Limit for uploaded package size in order to avoid OOM; If not set, default value: 50; Example: 50
      publishArchiveSizeLimitMb: 50
      # Optional; Limit for uploaded file (inside package) size in order to avoid OOM; If not set, default value: 15; Example: 20
      publishFileSizeLimitMb: 15
      # Deprecated. Required for Editor feature. Size limit for the branch content.
      branchContentSizeLimitMb: 50
      # Optional; If set - footer with this text is shown for all APIHUB users in APIHUB UI. Designed for maintenance windows notifications.; If not set, default value: ""; Example: Maintenance scheduled on 2023-10-15
      systemNotification: ''
      # Optional; Set to true to fail build on broken refs; If not set, default value: true; Example: true
      failBuildOnBrokenRefs: true


    # Section with monitoring configuration for APIHUB
    # APIHUB backend is using Prometheus for monitoring and Grafana for visualization
    monitoring:
      # Optional; Enables creation of Service Monitor. If not set, default value: false; Example: true
      enabled: false

    # Section with S3 storage integration parameters.
    s3Storage:
      # Optional; Set to true to enable S3 integration. S3 is used for store temporary relatively large files.; If not set, default value: false; Example: true
      enabled: false
      # Optional; S3 endpoint for client connection; If not set, default value: ""; Example: s3.example.com
      url: ''
      # Optional; Access Key ID from S3 storage; If not set, default value: ""; Example: s3-access-key
      username: ''
      # Optional; Secret key for S3 storage access; If not set, default value: ""; Example: s3-secret-key
      password: ''
      # Optional; Certificate for accessing S3 storage; If not set, default value: ""; Example: LS0tLS1CRUdJTiBQUklWQV...
      crt: ''
      # Optional; Bucket name in S3 storage; If not set, default value: ""; Example: apihub-bucket
      bucketName: ''
      # Optional; Set to true to store only build results (less data amout) in S3 storage; If not set, default value: false; Example: true
      storeOnlyBuildResult: false

    # Parameters for APIHUB Editor feature. Deprecated. Will be removed in future releases.
    editor:
      gitlabUrl: ''
      clientId: ''
      clientSecret: ''

    # Section with Olric configuration.
    olric:
      # Optional; Discovery mode for Olric. If not set, default value: local; Example: local
      discoveryMode: 'lan'
      # Optional; Replica count for Olric. If not set, default value: 1; Example: 1
      replicaCount: 1
      # Optional; Namespace for Olric discovery. If not set, default value: ""; Example: apihub
      namespace: ''

    # Section with cleanup jobs configuration
    cleanup:
      revisions:
        # Optional; Schedule for the revisions cleanup job. If not set, default value: "0 21 * * 0"; Example: "* * * * *"
        schedule: '0 21 * * 0'
        # Optional; If set to true, the revisions cleanup job will delete the last revision of the version. Otherwise, such revisions are skipped; If not set, default value: false; Example: true
        deleteLastRevision: false
        # Optional; If set to true, the revisions cleanup job will delete revisions with a 'release' status. Otherwise, such revisions are skipped; If not set, default value: false; Example: true
        deleteReleaseRevisions: false
        # Optional; Number of days to keep revisions before cleanup; If not set, default value: 365; Example: 180
        ttlDays: 365
      comparisons:
        # Optional; Schedule for the comparisons cleanup job. If not set, default value: "0 5 * * 0"; Example: "* * * * *"
        schedule: '0 5 * * 0'
        # Optional; Timeout in minutes for comparisons cleanup. After the timeout, the job will not be terminated immediately. 'VACUUM FULL' will be performed on the affected tables prior to job termination; If not set, default value: 360; Example: 60
        timeoutMinutes: 360
        # Optional; Number of days to keep ad-hoc comparisons before cleanup; If not set, default value: 30; Example: 180
        ttlDays: 30
      softDeletedData:
        # Optional; Cron schedule for soft deleted data cleanup job; If not set default value: '0 22 * * 5'; Example: '0 4 * * *'
        schedule: '0 22 * * 5'
        # Optional; Timeout in minutes for soft deleted data cleanup. After the timeout, the job will not be terminated immediately. 'VACUUM FULL' will be performed on the affected tables prior to job termination; If not set, default value: 600; Example: 120
        timeoutMinutes: 600
        # Optional; Number of days to keep soft deleted data before cleanup; If not set, default value: 730; Example: 700
        ttlDays: 730
      unreferencedData:
        # Optional; Cron schedule for unreferenced data cleanup job; If not set default value: '0 15 * * 6'; Example: '0 4 * * *'
        schedule: '0 15 * * 6'
        # Optional; Timeout in minutes for unreferenced data cleanup. After the timeout, the job will not be terminated immediately. 'VACUUM FULL' will be performed on the affected tables prior to job termination; If not set, default value: 360; Example: 120
        timeoutMinutes: 360
      builds:
        # Optional; Schedule for the builds cleanup job. If not set, default value: "0 1 * * 0"; Example: "* * * * *"
        schedule: '0 1 * * 0'

    # Optional; Section APIHUB extensions list. If not set, default value: [];
    extensions:
      # API Linter enabled by default. See section qubershipApiLinterService below for configuration
      - name: api-linter
        baseUrl: http://qubership-api-linter-service:8080
        pathPrefix: api-linter
      # APIHUB Agents Backend enabled by default. See section qubershipApihubAgentsBackend below for configuration
      - name: agents-backend
        baseUrl: http://qubership-apihub-agents-backend:8080
        pathPrefix: agents-backend

# Section with APIHUB Build Task Consumer configuration
qubershipApihubBuildTaskConsumer:
  image:
    repository: 'ghcr.io/netcracker/qubership-apihub-build-task-consumer'
    tag: 'dev'
  replicas: 1

  # Section with resource limits
  # Mandatory
  # Below are the default values which are good enough for any cases including production
  # For production usage increase replicas to 3 or 6
  resource:
    cpu:
      request: "100m"
      limit: "1.25"
    memory:
     limit: "4200Mi"
     request: "750Mi"
  env:
    operationsBuildBatch: "16" # most likely never change this value

    # Optional; Set log level on init to specified value. Values: Info, Warn, Error, etc; If not set, default value: INFO; Example: DEBUG
    logLevel: ''

    # Mandatory; APIHUB access token. In case of clean installation - must be the same as in qubershipApihubBackend.env.zeroDayConfiguration.accessToken section; If not set, default value: ""; Example: access-token-12345
    accessToken: ''

# Section with APIHUB UI configuration
qubershipApihubUi:
  image:
    repository: 'ghcr.io/netcracker/qubership-apihub-ui'
    tag: 'dev'
  replicas: 1

  # Section with resource limits
  # Mandatory
  # Below are the default values which are good enough for any cases including production
  resource:
    cpu:
      request: "30m"
      limit: "1"
    memory:
     limit: "256Mi"
     request: "64Mi"
  env:
    apihubBackendAddress: 'qubership-apihub-backend:8080' # k8s local address of apihub backend service. Do not change it unless you know what you are doing
    apihubNcServiceAddress: 'qubership-apihub-backend:8080' # k8s local address of apihub custom service. Do not change it unless you know what you are doing
    apiLinterServiceAddress: 'qubership-api-linter-service:8080' # k8s local address of api linter service. Do not change it unless you know what you are doing
    apihubAgentsBackendAddress: 'qubership-apihub-agents-backend:8080' # k8s local address of apihub agents backend service. Do not change it unless you know what you are doing

  # Mandatory; Factual APIHUB server URL in your environment.; If not set, default value: ""; Example: https://apihub.example.com
  apihubUrl: ''

  # Flag to enable/disable http UI ingress creation
  ingress:
    enabled: false

  # Flag to enable/disable https UI ingress creation
  # https Ingress URL is used in APIHUB_URL ENV VAR on qubership-apihub-backend, so disabling its creation will make APIHUB deployment unable to work
  tlsIngress:
    enabled: true
    tlsSecret:
      # Certificate used for TLS termination in https ingress, base64 encoded. If not set, default value: ""; Example: LS0tLS1CRUdJTiBQUklWQV...
      certificate: ''
      # Private key for certificate above, base64 encoded. If not set, default value: ""; Example: LS0tLS1CRUdJTiBQUklWQV...
      certificateKey: ''

# Section with APIHUB API Linter service configuration
qubershipApiLinterService:
  image:
    repository: 'ghcr.io/netcracker/qubership-api-linter-service'
    tag: 'dev'
  replicas: 1

  # Section with resource limits
  # Mandatory
  # Below are the default values which are good enough for any cases including production
  resource:
    cpu:
      request: "30m"
      limit: "1.25"
    memory:
     request: "150Mi"
     limit: "1000Mi"
  env:
    # Optional; Set log level on init to specified value. Values: Info, Warn, Error, etc; If not set, default value: INFO; Example: DEBUG
    logLevel: 'INFO'

    # Section with PostgreSQL database connection parameters
    database:
      # Mandatory; PostgreSQL database host ; If not set, default value: localhost; Example: postgres.example.com
      host: ''
      # Mandatory; PostgreSQL database port; If not set, default value: 5432; Example: 5432
      port:
      # Mandatory; Logical database in PostgreSQL cluster for APIHUB. Manual pre-creation required; If not set, default value: apihub; Example: apihub_backend_prod_db
      name: ''
      # Mandatory; User for database.name database; If not set, default value: apihub; Example: apihub_api_linter_service_prod_admin
      username: ''
      # Mandatory; Password for database.user.; If not set, default value: apihub; Example: apihub_api_linter_service_prod_password
      password: ''
    # Confguration for linters
    linters:
      spectral:
        # Path to Spectral binary inside docker container
        bin_path: 'resources/spectral/linux/spectral'
    apihub:
      # Mandatory; Factual Qubership APIHUB server URL in your environment.; If not set, default value: ""; Example: https://apihub.example.com
      url: 'http://qubership-apihub-ui:8080'
      # Mandatory; APIHUB access token. In case of clean installation - must be the same as in qubershipApihubBackend.env.zeroDayConfiguration.accessToken section; If not set, default value: ""; Example: access-token-12345
      accessToken: ''

# Section with Qubership APIHUB Agents Backend deployment configuration
qubershipApihubAgentsBackend:
  # Optional; Qubership APIHUB Agents Backend release version; If not set, default value: unknown; Example: 1.0.0
  version: ''
  image:
    repository: 'qubership-apihub-agents-backend'
    tag: 'dev'

  # Section with resource limits
  # Mandatory
  # Below are the default values which are good enough for any cases including production
  resource:
    memory:
      request: "256Mi"
      limit: "256Mi"
    cpu:
      request: "30m"
      limit: "1"

  # Section with business and technical parameters for Qubership APIHUB Agents Backend.
  env:
    # Optional; Set log level on init to specified value. Values: Info, Warn, Error, etc; If not set, default value: INFO; Example: DEBUG
    logLevel: ''
    # Section with PostgreSQL database connection parameters
    database:
      # Mandatory; PostgreSQL database host ; If not set, default value: localhost; Example: postgres.example.com
      host: ''
      # Mandatory; PostgreSQL database port; If not set, default value: 5432; Example: 5432
      port: ''
      # Mandatory; Logical database in PostgreSQL cluster for APIHUB. Manual pre-creation required; If not set, default value: apihub_agents_backend; Example: apihub_agents_backend_prod_db
      name: ''
      # Mandatory; User for AGENTS_BACKEND_POSTGRESQL_DB_NAME database; If not set, default value: apihub_agents_backend; Example: apihub_agents_backend_prod_admin
      username: ''
      # Mandatory; Password for AGENTS_BACKEND_POSTGRESQL_USERNAME user.; If not set, default value: ""; Example: apihub_agents_backend_prod_password
      password: ''

    apihub:
      # Mandatory; Factual Qubership APIHUB server URL in your environment.; If not set, default value: ""; Example: https://apihub.example.com
      url: 'http://qubership-apihub-ui:8080'
      # Mandatory; APIHUB access token. In case of clean installation - must be the same as in qubershipApihubBackend.env.zeroDayConfiguration.accessToken section; If not set, default value: ""; Example: access-token-12345
      accessToken: ''

    # Optional; If specified, during discovery the package structure is copied from the default workspace to the target discovery workspace.; If not set, default value: ""; Example: QS
    defaultWorkspaceId: ''

    # Optional; Schedule for the snapshot cleanup job. If not set, default value: "0 2 * * 0"; Example: "* * * * *"
    snapshotsCleanupSchedule: ''
    # Optional; Number of days to keep snapshots before cleanup; If not set, default value: 183; Example: 30
    snapshotsTtlDays: ''

    # Optional; Set to true to enable apihub playground work without authtorization. Dangerous. Not recommended; If not set, default value: false; Example: true
    insecureProxy: false

    # Optional; Allows to set extra allowed origin to CORS header. Used for FE debugging. Should be empty on prod evs.; If not set, default value: ""; Example: https://localhost:5137
    originAllowed: ''
